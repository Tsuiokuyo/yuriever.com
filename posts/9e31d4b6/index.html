<!doctype html><html lang=zh-tw><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>使用Foobar2000+request_http建個基於icecast2的可點歌網路電台 - 於是我又重看一次</title><meta name=Description content="人生無法重來，但是我可以紀錄與回憶，這個部落格拿來記錄用，不過人都是懶惰的...。"><meta property="og:title" content="使用Foobar2000+request_http建個基於icecast2的可點歌網路電台"><meta property="og:description" content="成品大概是這樣吧
估計若干時間後，會整理音樂庫，改成用airsonic、navidrome甚至是PLEX來架設
如果無法設定guest權限，那這個網址屆時就會停止了，
至於emby、jellyfin就算了，因為先前有混用多種無損格式的關係，覺得體感不好。"><meta property="og:type" content="article"><meta property="og:url" content="https://yuriever.com/posts/9e31d4b6/"><meta property="og:image" content="https://yuriever.com/assets/favicons.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-13T14:48:06+08:00"><meta property="article:modified_time" content="2024-01-19T00:00:00+00:00"><meta property="og:site_name" content="於是我又重看一次"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yuriever.com/assets/favicons.png"><meta name=twitter:title content="使用Foobar2000+request_http建個基於icecast2的可點歌網路電台"><meta name=twitter:description content="成品大概是這樣吧
估計若干時間後，會整理音樂庫，改成用airsonic、navidrome甚至是PLEX來架設
如果無法設定guest權限，那這個網址屆時就會停止了，
至於emby、jellyfin就算了，因為先前有混用多種無損格式的關係，覺得體感不好。"><meta name=application-name content="於是我又重看一次"><meta name=apple-mobile-web-app-title content="於是我又重看一次"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/assets/favicons.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yuriever.com/posts/9e31d4b6/><link rel=prev href=https://yuriever.com/posts/0f972d9c/><link rel=next href=https://yuriever.com/posts/924b9803/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><meta name=google-adsense-account content="ca-pub-6943220390459023"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"使用Foobar2000+request_http建個基於icecast2的可點歌網路電台","inLanguage":"zh-TW","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yuriever.com\/posts\/9e31d4b6\/"},"genre":"posts","keywords":"foobar2000","wordcount":7151,"url":"https:\/\/yuriever.com\/posts\/9e31d4b6\/","datePublished":"2022-10-13T14:48:06+08:00","dateModified":"2024-01-19T00:00:00+00:00","license":"Tsuiokuyo","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Tsuiokuyo"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=於是我又重看一次><img class="lazyload logo" src=/svg/loading.min.svg data-src=/assets/favicons.png data-srcset="/assets/favicons.png, /assets/favicons.png 1.5x, /assets/favicons.png 2x" data-sizes=auto alt=/assets/favicons.png title=/assets/favicons.png>於是我又重看一次</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>標籤 </a><a class=menu-item href=/categories/>分類 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章標題或內容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切換主題><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=於是我又重看一次><img class="lazyload logo" src=/svg/loading.min.svg data-src=/assets/favicons.png data-srcset="/assets/favicons.png, /assets/favicons.png 1.5x, /assets/favicons.png 2x" data-sizes=auto alt=/assets/favicons.png title=/assets/favicons.png>於是我又重看一次</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章標題或內容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>標籤</a><a class=menu-item href=/categories/ title>分類</a><a href=javascript:void(0); class="menu-item theme-switch" title=切換主題>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目錄</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">使用Foobar2000+request_http建個基於icecast2的可點歌網路電台</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Tsuiokuyo</a></span>&nbsp;<span class=post-category>收錄於 <a href=/categories/foobar2000/><i class="far fa-folder fa-fw" aria-hidden=true></i>foobar2000</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-10-13>2022-10-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;約 7151 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;預計閱讀 15 分鐘&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/assets/foobar2000.jpg data-srcset="/assets/foobar2000.jpg, /assets/foobar2000.jpg 1.5x, /assets/foobar2000.jpg 2x" data-sizes=auto alt=/assets/foobar2000.jpg title=/assets/foobar2000.jpg></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文章最後更新<span class=timeago datetime=2024-01-19T00:00:00 title="January 19, 2024">January 19, 2024</span>，文中內容可能已經過時了，有疑慮請當成參考。</div></div></div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目錄</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#個人用備註>個人用備註</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>成品大概是這樣吧</p><p>估計若干時間後，會整理音樂庫，改成用airsonic、navidrome甚至是PLEX來架設<br>如果無法設定guest權限，那這個網址屆時就會停止了，<br>至於emby、jellyfin就算了，因為先前有混用多種無損格式的關係，覺得體感不好。</p><p>(有封鎖特定IP區段連入)</p><p>點歌台
已改用私人的navidrome</p><p>狀態
已改用私人的navidrome</p><p>(icecast)</p><p>(shoutcast)</p><p>其實會收聽的都在shoutcast，因為很多程式都能直接搜尋shoutcast電台</s></p><p>不過我這幾乎都是日本人在收聽的，擔心哪天吃官司，因此關閉icecast的yp跟shoutcast。</p><p>補充目前所使用的DSP，</p><p>1.Resampler (Sox) mod2</p><p>目前44.1kHz約有(82.5%)、96kHz(10.2%)、48kHz(7.1%)、192kHz(0.2)、88.2(?)kHz(0.0%)</p><p>因為我自己串流主要用48kHz聽歌，因此第一個Sox為升頻至48kHz</p><p>Passband:95%，phase response:50%</p><p>2.Resampler (Sox) mod2</p><p>第二個則降頻192kHz及96kHz至48kHz</p><p>Passband:95%，phase response:0%</p><p>3.ReplayGain(alternative)</p><p>基於EBU R 128音軌增益，-14LUFS,-1dBTP(compress peaks)</p><p>4.跳過靜音區域</p><p>其他類似的DSP是Fake Gapless、Corssmix、Fade in/out</p><p>5.交叉漸變器</p><p>淡出淡入功能</p><p>類似的插件是 SqrSoft Advanced Crossfader</p><p>6.<s>Vorbis Streamer</s></p><p>要注意的是，上方的順序不能擺錯，因為DSP的順序是從上到下，串流插件一定要擺在最下面，不然會發現串流與本機的播放聲音不同，第4點比vorbis streamer低則會讓串流中斷，也因此我才會知道那些類似的DSP，試到最後發現只是擺錯位置。</p><p>推送已改用butt，因為超過4萬首歌後，換首歌時讀取會卡住導致foo_Vorbis推送中斷，
估計是我訊源及IO負荷太重的關係&mldr;，緩衝太長又會讓問題更嚴重&mldr;</p><p>另外重採樣部分 foobar2000的DSP大概有</p><p>Sox、SRC(Secret Rabbit Code)、SSRC、RetroArch、multiresampler</p><p>雖然爬文大多都是推薦Sox，但我當時還是浪費一堆時間爬文，使用Cool Edit Pro建立音檔來測試，結果最後還是選擇Sox&mldr;</p><p>順便留一個國外各種特定轉換的重採樣的圖表網頁參考</p><p><a href=http://src.infinitewave.ca/ target=_blank rel="noopener noreffer">http://src.infinitewave.ca/</a></p><p>剩下關於機碼、MMCSS模式、記憶體優先級、峰值限制等等，無聊時再回來補，</p><p>其實這些google都有，畢竟我只是跟著別人的腳步，跟著各種發燒友文章重新調整，雖然在這裡最後都會因為串流關係壓成320k就是了。</p><p>順帶一提，聽歌通常建議軟體音量調最大，剩餘就是用硬體調整</p><p>用電腦端舉例：系統音量、播放器音量(100%) -> DAC、擴大機音量(調整2) -> 主動式喇叭(調整1)、耳機、被動式喇叭</p><p>基本上就是從最右邊開始調整</p><p>因為從最左邊的數位音訊，降低就相當於失真了，然後到最右邊轉成類比音訊也只是把失真後的資料再放大而已，基本上用頻譜圖就能看出來了，軟體的聲音低，可以看到某些細節已經歸零了，那你終端音量再大細節也不會憑空產生，其實就跟降頻後再升頻一樣</p><p>不過如果因為系統音量問題導致破音，那也只能從軟體部份或用衰減器看看來處理了</p><p>2023/06/01 隨著歌曲量增多，換歌時會莫名卡住，全文件緩衝設1GB反而得到嚴重副作用</p><p>測試後確定為訊源問題，緩衝寫入RAM時會卡住，調整細節寫在裡面，因為隨時都可能進行調整。</p><p>不過最大的原因我覺得是我的訊源撐不住就是了，弄台好的設備也許就沒問題了</p><p>以下3月的調整一段時間內不會放改法教學上來，因為有點麻煩，暫時也沒有心力來寫。
估計之後想寫時也忘了改了啥。</p><p>2023/03/15 解決嵌入chatango聊天室報錯問題，簡單的說就是聊天室抓不到特定的數值，因此只能抓原始碼並忽略某數值了，而忽略似乎沒產生甚麼問題，算是只有用foobar編譯時才會有的問題，不過近期到是想把它移除就是了。</p><p>2023/03/12 花了兩天研究，基本上搞定串流動態歌詞了，靜態歌詞基本上無法處理，特殊版本也無法處理，如:歌名 XXXver.，直接去掉字尾很容易比對錯誤，基本上翻唱、LIVE、同人歌其實也很容易有問題。</p><p>2023/03/10 取封面平均色來改變背景色，本來是想實現頻譜會依封面而變色，不過有些平均不是很明顯，因此作罷，下一步估計是研究弄出動態歌詞。</p><p>2023/03/08 換成了上面那個畫面，本來想用Javascript version ( New! )這個畫面的，但想要有以前那種黑底風格因此換了個模板，也塞入了頻譜與進度條等等調整，只不過因為黑底面畫面的畫面生成方式不同，引入js套件會出現問題，所以沒有甚麼新花樣。
，在Javascript version ( New! )能辦到的事情，黑底畫面的js不一定能辦到，這連jquery都無法引入&mldr;。</p><p>2023/03/07 花了一大段時間想辦法在網頁上塞入封面，因為串流的metadata不含圖片資訊，用foobar2000串流送出圖片資訊，這基本上完全沒有相關資料及討論，request_http沒有原始碼，反編譯重寫難度太高，所以只能去找其他元件來混用，
但因為別的元件是區網用的，在公網會有安全性問題，因此我取得後原始碼把一些功能移除，移除的難度就不大了，只是花了很多時間建置C++的環境來重新編譯dll檔&mldr;，實際上90%的時間就是花在建置環境，編譯完成後又遇到跨網域問題&mldr;。</p><p>2023/02/24 修復換頁千分位錯誤，</p><p>2022/12/15 補充
當前(v2.4.1)版本的ICECAST的FLAC尚不支援METADATA，難怪手機串流時能抓到METADATA，但是
官網那邊看不到，不過github看到有人提出問題過，才知道不是我的問題，不知何時才會支援，
而其他格式倒是正常，雖然這其實沒啥必要，只是看到這邊有顯示on Air的歌曲會比較爽一點
<a href="http://dir.xiph.org/search?q=tsuiokuyo" target=_blank rel="noopener noreffer">http://dir.xiph.org/search?q=tsuiokuyo</a></p><p>目前已不使用foo_shuicast，因為用shuicast在某些時候會有破音問題，因為只有hi-res跟mp3會破音，懷疑是跟歌曲本身的位元率高低有關，因此改用butt+vb audio cable來播放，這樣才不會接收到本機的音效，順便一提icecast的多個Genre 設定有固定格式，否則會直接送你異常，第二個以後的類型都要加, 才行，一定要用",空格"，如：Anime, Jpop, Game，這爛分割方式讓我剛開始研究好久。</p><h3 id=個人用備註>個人用備註</h3><p>最讓我感到可惜的是我沒有收集水晶琴、音樂盒版本的配樂，
基本上AVG遊戲甚至裏番的配樂，錯過了大概這輩子不會再聽到了吧，畢竟冷門且小眾，
即使是好聽的片頭曲基本上也沒有熱度，更別說是被別人來拿使用在影片中。
只是要我再次收集等同於要全部重來，好聽是好聽，可惜也很可惜，
但我主要聽的還是人聲為主，因此也只能放棄了。</p><p>shoutcast則需要到 <a href=https://radiomanager.shoutcast.com/ target=_blank rel="noopener noreffer">https://radiomanager.shoutcast.com/</a> 註冊拿到Authhash才會被搜尋到</p><p>歌詞部分需要修改LargeFieldsConfig檔，否則http上會顯示"?"</p><p>至於一些foobar2000音質上的調整就直接放在網頁左上了</p><p>兩個串流測試用的vst插件</p><p>Voxengo SPAN Plus</p><p>Youlean Loudness Meter2</p><p>用於篩選是否有設定增益</p><pre tabindex=0><code>$if(%replaygain_track_gain%,$char(13)有播放增益資料,$char(13)無播放增益資料)|$puts(path,$replace($directory_path(%path%),\,|$char(13))|%filename_ext%
$ifgreater(%subsong%,0,|%tracknumber%.%title%,))
$puts(path,$substr($get(path),$add($strchr($get(path),|),1),$len($get(path))))
$substr($get(path),$add($strchr($get(path),|),1),$len($get(path)))
</code></pre><p>SQLite Utilities部分</p><p>基於音頻md5篩選是否為重複歌</p><pre tabindex=0><code>insert into Playlist_Updatable (path, playlist_name)
  select path,
         &#39;完全重複&#39;
  from mediaLibrary
  where md5 in (select md5
                  from mediaLibrary
                  group by md5
                  having count(*)&gt;1
               );
</code></pre><p>只要來源相同，基本上相同格式的音頻md5都會一樣的，即使修改過tag或無損互轉</p><p>例如:wav轉alac再轉ape再轉flac 跟wav直接flac</p><p>兩者的音頻md5也會是一樣的，</p><p>基於其他條件重複，藝術家、標題、專輯、相簿、長度、曲目編號、作曲家</p><pre tabindex=0><code>insert into PlaylistUpdatable(path,playlist_name)
select a.path, &#39;其他重複&#39;
  from mediaLibrary a
         inner join
       (select artist, title, album, length, tracknumber, composer
          from MediaLibrary
          group by artist, title, album, length, tracknumber, composer
          having count(*)&gt;1
       ) b on (    a.artist is b.artist
               and a.title is b.title
               and a.album is b.album
               and a.length is b.length              
               and a.tracknumber is b.tracknumber
               and a.composer is b.composer)
  order by a.path
</code></pre><p>畢竟即使md5不同也可能是重複的</p><p>例如:拿張DVD ISO 跟 OTOTOY買的同一專輯，兩者出來的音頻MD5就可能不一樣了</p><p>再來就是存歌的空間不足，看來要用Flac -8ep重壓一次了，</p><p>畢竟目前有下面這堆格式&mldr;</p><p>FLAC</p><p>MP3</p><p>Apple Lossless</p><p>Monkey&rsquo;s Audio</p><p>Tom&rsquo;s lossless Audio Kompressor</p><p>True Audio</p><p>Audio Interchange File Format</p><p>AAC</p><p>WavPack</p><p>Opus</p><p><s>Waveform Audio File Format</s></p><p>不過DSD編碼的wv就無法處理了，至於為什麼會有這麼多種格式&mldr;</p><p>順便保留一下在U2的網友(#38893)所分享的各壓縮等級所耗時間及體積，</p><p>測試檔為，Startear/春奈るな 期間生産限定アニメ盤</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/9e31d4b6/images/lossless_startear.png data-srcset="/posts/9e31d4b6/images/lossless_startear.png, /posts/9e31d4b6/images/lossless_startear.png 1.5x, /posts/9e31d4b6/images/lossless_startear.png 2x" data-sizes=auto alt=/posts/9e31d4b6/images/lossless_startear.png title=foo_streamer width=1323 height=1167></p><p>因為看了last.fm後，覺得同一首歌的播放次數不合理，因此再稍微測試了一下，最後發現是Shuffle (tracks)在程式重啟之後會重新洗牌一次，但是即使算入點播以及不同專輯的相同歌曲，我還是覺得重複播放率太高就是了。</p><p>順便提提Shuffle (tracks)跟random的差別</p><p>官方說明可直接看foobar2000的FAQ <a href=https://www.foobar2000.org/FAQ#random_shuffle_playback_order target=_blank rel="noopener noreffer">https://www.foobar2000.org/FAQ#random_shuffle_playback_order</a></p><p>簡單的說就是我有五首歌 1~5</p><p>如果我播放15次共三輪，</p><p>Shuffle (tracks)模式，會把他打亂之後不重複的排序，因此隊伍可能會是</p><p>第一輪:2、3、1、5、4</p><p>第二輪:2、3、1、5、4</p><p>第三輪:2、3、1、5、4</p><p>第四輪如果新增一首歌進去，那可能會是:2、3、1、6、5、4</p><p>意思是它會在隊列中隨機位置放入，基本上想要不重複播放就是這個亂序(音軌)</p><p>random模式，單純隨機播放</p><p>第一輪:1、2、1、2、1</p><p>第二輪:3、2、3、4、1</p><p>第三輪:4、3、2、1、2</p><p>意思就是，除了不會連續2次同一首歌之外，都有可能發生，所以發現有一首歌從來沒被播放過也是正常的。</p><h3>以下為舊文章(2022/10)</h3><p>現在雖然都用google drive串流來聽歌，但不曉得哪一天無限空間會被拔掉，總要有幾個備援方案，</p><p>現在只有emby能當成備援而已，但emby不太可能支援小眾的無損壓縮格式，雖然無損壓縮互轉除非編碼有問題不然是會相同的，但我還是保留EAC時的格式，而且emby的app我覺得不是很好用，因此來玩玩看這個</p><p>此文為簡單的icecast v2.4.4 foobar2000 stream Components 以及 foo_request_http_v09-0.4說明</p><p>不過這些東西九成都已經過時了&mldr;教學都好幾年以前的產物了，而且連載點都很難找了，可惜的是PTT的foo_request_http_v09-0.4_fix版我倒是真的找不到了，所以那邊只能自己用懶人改法了，
不過這也是因為我只想在windows用foobar直接推送的關係，不然現在還有很多其他更方便的軟體&mldr;。</p><p>而選擇使用icecast的原因則單純只是因為它支援FLAC格式串流，目前Shoutcast看起來似乎不支援flac的樣子，我也不確定，我也懶得去測&mldr;，兩個電台的插件操作方式是一樣的，就改個選項而已。</p><p>目前手邊的無損格式至少有六種，WAV、FLAC、APE、TAK、TTA、M4A(ALAC)，本想說大不了全部轉為FLAC而已，不過看來是可以靠foobar自己轉碼成FLAC推送(?)</p><p>首先先提以下四個插件</p><img src=images/foo_streamer.jpg title alt=foo_streamer data-align=left><p>foo_streamer，版本:v141(2015)，選單位於view -> streaming client，可以看到目前傳輸的位元率、目前在線的用戶端、以及播放歷史，對我來說最有用的就是看位元率吧，很直觀就能了解我確實是在推送FLAC，但換歌時，網頁(用戶)端會自動暫停播放音樂，這個真不能忍，不過我倒是沒特別去研究解決方法，且因為metadata沒有自動推送也是原因之一，在Icecast states沒辦法看到目前播放的音樂名稱，因此放棄。</p><p>2023/04/06 目前shoutcast是走這個推MP3，上面為舊文只是沒設定好罷了</p><img src=images/foo_vorbisstream_fix3.jpg title alt=foo_vorbisstream_fix3 data-align=left><p>foo_vorbisstream_fix3，版本:v1.1_fix3(2013)，選單位於設定 -> dps管理器中，這個應該是問題最少的了，但是他沒辦法調整推送的編碼。
2023/04/06 如果要吃DSP的話，必須把它移到最下面，否則因為優先順序關係會吃不到。</p><p>foo_edcast，版本:v3.1.23(2009)，我的foobar2000版本過高(1.6.10)，直接掰掰</p><img src=images/foo_shuicast.jpg title alt=foo_shuicast data-align=left><p>foo_shuicast，版本:v0.47(2018年)，選單位於設定 -> dps管理器，其實這個介面我不太喜歡，鑒於上面幾個我都有意見，那麼也只能用這個了，亂碼似乎改個UTF-8就行了，反正也不能弄到目前播放的音樂，只不過這個可選編碼，網頁(用戶)端又不會自動暫停，我還能說甚麼。</p><p>順便一提
插件內選用quality的話，0=64,1=80,2=96,3=112,4=128,5=160(kbps)，能到多高，我就不知道了</p><p>foobar2000設定大概就這樣而已，再來是icecast2(v2.4.4)部分</p><p>官網下載安裝完成後，到根目錄簡單的調整icecast.xml</p><p>基本上較重要的大概只有</p><p><admin-user><admin-password>網頁端管理員登入用</p><p><source-password>foobar2000推送用密碼</p><p><port>根據需求改port</p><hostname><p><directory>可否收錄在icacast2 中</p><p>其實xml檔提供的註解還挺充實的，雖然我是靠翻譯看的</p><p>剩餘如<location> <admin>僅用於前端顯示，有能力的倒也能直接去改xsl檔</p><p>由localhost:port/status-json.xsl能看到推送的資料，有能力的也能去改DLL檔&mldr;</p><p>改完後執行icecast.bat啟動icecast後記得到foobar插件內connect</p><p>就能到localhost:8000、127.0.0.1:8000看看icecast是否正常以及測試播放</p><img src=images/Icecast2_Status.jpg title alt=Icecast2_Status data-align=left><p>而掛載點則為http://localhost:8000/stream.ogg，也就是插件內的mountpoint路徑</p><p>預設是stream，就是這個電台的檔案名稱，能直接讀取它</p><p>弄上實體IP或動態域名後</p><p>基本上支援串流的軟體應該都能直接吃這串路徑來聽歌，應該啦。</p><p>順便一提，這掛載點如果直接進入時有IDM或其他下載器，瀏覽器開啟後可能會變成下載ogg檔。</p><p>最後就是有bug的foo_request_http點歌插件了&mldr;，選單位於設定 -> 工具 -> request http</p><img src=images/basic_settings.jpg title alt=basic_settings data-align=left><p>basic settings頁面</p><p>畫面沒甚麼好說的就是port不要互衝，模板路徑選好，要播放的歌曲放進public playlist內</p><p>勾選Update when requests changed</p><p>再來是more settings頁面</p><p>Admin Settings: 設定遠端http登入foobar控制，預設是全鎖
右邊的三選項是下載選項，</p><p>1.Allow download in public playlist</p><p>2.Allow in upload playlist</p><p>3.Allow in play history</p><p>設定如下
完全不允許下載 => 三個都別勾
只允許下載別人上傳的 => 勾2和3
所有都可以下載 => 勾1和3
Enable Upload:允許別人可上傳音樂,看你要不要開啟</p><p>Search format: 設定搜尋時尋找歌曲的那些資訊</p><p>Use fast search: 不要勾，這個搜尋模式有BUG會讓電台當掉</p><p>Max song view: 歌單單頁顯示最大歌曲數</p><p>Max request num: 最大點歌數</p><p>Max request per ip: 每人最大點播歌曲數</p><p>Max search result num: 搜尋數量上限</p><p>當搜尋到的結果量到達這個數量就會強制停止
減輕伺服器負擔
Index threshold: 條目歌曲下限，當同專輯或歌手歌曲少於這個數量，
就不會出現在專輯或歌手歌單裡，
設為0就是所有歌全部都編到條目裡。
不過歌名搜尋有問題可以嘗試點ReIndex讓它重建索引看看，
我有遇到歌名卻找到關鍵字的下一首歌的問題，重建索引就正常了。</p><p>Song history num: 歷史紀錄的歌曲數量，當被點過的歌還在歷史紀錄上，
就不能再次點同首歌。</p><p>Sub list item num: 系統預先選歌的數量</p><p>Priority per IP: 每個人點歌的權重</p><p>Priority per time: 當前面的點播歌曲播完，已點的歌增加的權重</p><p>Max priority: 歌曲最大權重
(權重越大的歌曲播放越優先)</p><p>Debug Requst: 除錯</p><p>Deny Proxy: 防止Proxy來的連線，安全和點播上的顧慮，可以勾起來</p><p>到點擊start後 status會從offline變成online，屆時就能進去localhost:xxxx測試了，</p><p>有個明顯的bug就是所有的列表換頁功能無法使用，也就是沒去修bug的話Playlist list只能顯示前100筆</p><img src=images/request_http_index.jpg title alt=request_http_index data-align=left><p>Javascript version ( New! ) <s>看起來還未完成，不能用</s></p><img src=images/ext.jpg title alt=ext data-align=left><p>2023/02/24，我發現光是這個找歌部分就比flat好上幾百倍了，</p><p>但如要改用這個的話，還要想辦法美化，因為畫面真的空的</p><p>有看到網友改的，起初還看不出來是的模板，也是塞進去一些東西</p><p>不過這東西，有機會再去改吧</p><p>恩，有機會&mldr;&mldr;</p><p>畢竟我只是用來自己聽的，所以才選擇flat，而且現在都考慮走UPnP了&mldr;</p><p>Simple version</p><img src=images/Simple.jpg title alt=Simple data-align=left><p>還不錯的畫面</p><p>song file uploader，這個沒甚麼好提的</p><p>Javascript version ( 2 column )</p><img src=images/2_column.jpg title alt=2_column data-align=left><p>Javascript version ( flat )</p><img src=images/flat.jpg title alt=flat data-align=left><p>後弄成以下這樣，不過我已經棄用了</p><img src=images/flatEdit.jpg title alt=flatEdit data-align=left><p>基本上會選擇的大概就是Simple version、2 column 、 flat 三擇一後並自己調整了</p><p>至於bug部分 PTT倒是有人也提供解法啦，雖然改好的檔已經沒了，但問題點都已經有指出來了，有點懶得去碰它&mldr;</p><p><a href=https://www.ptt.cc/bbs/WebRadio/M.1296124848.A.E0A.html target=_blank rel="noopener noreffer">https://www.ptt.cc/bbs/WebRadio/M.1296124848.A.E0A.html</a></p><p><a href=https://ptt.healtyman.xyz/?man/WebRadio/D766/D6CE/M.1296145083.A.AB6.html target=_blank rel="noopener noreffer">https://ptt.healtyman.xyz/?man/WebRadio/D766/D6CE/M.1296145083.A.AB6.html</a></p><p>既然已知是參數問題，</p><p>所以我倒是沒改那麼多，直接用懶人方式調整</p><p>僅僅在requester.js中多加三行讓他的列表能夠正常運作而已</p><p>.replace(&rsquo;,&rsquo;,&rsquo;&rsquo;)已直接補進去，100這個數值需要同時調整前端，所以沒在這裡直接調整</p><code><p>updateFromThis: function(element, params, isFocus, isBackground) {</p><p>​ <strong>params = params.replace(&rsquo;_song_id=&rsquo;, &lsquo;&song_id=&rsquo;)</strong></p><p>​ <strong>page = params.substring(params.lastIndexOf(&rsquo;=&rsquo;) + 1, params.length)</strong></p><p>​ <strong>params += &lsquo;&page=&rsquo; + page.replace(&rsquo;,&rsquo;,&rsquo;&rsquo;) / 100</strong></p><p>​ var p = element;</p><p>​ for (; p != null; p = p.parentNode) {</p><p>​ logDebug(p);</p><p>​ if (Element.hasClassName(p, &rsquo;tab_item&rsquo;)) break;</p><p>​ }</code></p><p>第一行是把傳入的參數修正，</p><p>第二行是取得他要查詢的N筆資料，</p><p>第三行是把那N筆轉成頁數，</p><p>大概是這樣</p><p>其他bug如果有遇到就再說了</p><p>2023/02/24 修正頁數千分位異常，以及分頁改foobar2000獲取
由
<code><strong>params += &lsquo;&page=&rsquo; + page / 100</strong></code>
這部分已經直接在上面改了就是補上.replace(&rsquo;,&rsquo;,&rsquo;&rsquo;)去除千分位而已而已</p><p>再來就是把那個最大檢視數量改由foobar2000拿取而不是寫死，不然分頁會有點小小的問題
<code><em><strong>maxView = document.getElementById(&ldquo;maxView&rdquo;).innerText</strong></em>
<strong>params += &lsquo;&page=&rsquo; + page.replace(&rsquo;,&rsquo;,&rsquo;&rsquo;) / maxView</strong></code></p><p>另外到前端中FOOBAR2000-Info的tag隨便找個地方塞進%max_song_view%這個參數
例如
<code><span>View# <span class=caution>$if(%playlist_name%, %playlist_name% , $if(%search_text%, " %search_text% " search result, %index_id%))</span></p><pre><code>***顯示筆數：&lt;span id='maxView'&gt;%max_song_view%&lt;/span&gt; ***
Page: %current_page%&lt;/span&gt;
&lt;script&gt;
var isDownload = %enable_download_in_playlist% == 1;
if '('isDownload')' {
    addRule'(''''.download''', '''display:table-cell;'''')';
}
&lt;/script&gt;
</code></pre></code></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新於 2024-01-19</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://yuriever.com/posts/9e31d4b6/ data-title=使用Foobar2000+request_http建個基於icecast2的可點歌網路電台 data-hashtags=foobar2000><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://yuriever.com/posts/9e31d4b6/ data-hashtag=foobar2000><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://yuriever.com/posts/9e31d4b6/ data-title=使用Foobar2000+request_http建個基於icecast2的可點歌網路電台><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://yuriever.com/posts/9e31d4b6/ data-title=使用Foobar2000+request_http建個基於icecast2的可點歌網路電台><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://yuriever.com/posts/9e31d4b6/ data-title=使用Foobar2000+request_http建個基於icecast2的可點歌網路電台 data-image=/assets/foobar2000.jpg><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/foobar2000/>foobar2000</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主頁</a></span></section></div><div class=post-nav><a href=/posts/0f972d9c/ class=prev rel=prev title=談談個人收藏動畫的方式><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>談談個人收藏動畫的方式</a>
<a href=/posts/924b9803/ class=next rel=next title=PSP及PSV實機輸出畫面至電腦並提升畫質>PSP及PSV實機輸出畫面至電腦並提升畫質<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Tsuiokuyo</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到頂部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看評論><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png alt=雷姆 onmouseover='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuB.png"' onmouseout='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png"' title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png alt=雷姆 onmouseover='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuB.png"' onmouseout='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png"' title=回到底部></div></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"複製到剪貼板",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"沒有找到結果",snippetLength:50}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script>
<script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script>
<script type=text/javascript src=/themes/custom.js></script></body></html>